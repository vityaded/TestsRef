{% extends "layouts/base.html" %}

{% block title %}Home - Test App{% endblock %}

{% block content %}
  <section class="panel panel-strong hero">
    <div>
      <div class="eyebrow">Game-based learning</div>
      <h1>Level up your reading and quiz skills.</h1>
      <p>Jump into vibrant quiz worlds, build vocab, and keep your streak alive with instant feedback.</p>
      <div class="hero-actions">
        <a class="btn-game btn-game-primary" href="{{ url_for('main.index') }}">Play now</a>
        {% if current_user.is_authenticated %}
          <a class="btn-game btn-game-secondary" href="{{ url_for('tests.add_test') }}">Build a test</a>
        {% else %}
          <a class="btn-ghost" href="{{ url_for('auth.signup') }}">Create a free account</a>
        {% endif %}
      </div>
    </div>
    <div class="result-card">
      <p class="text-muted mb-1">What's here today?</p>
      <div class="quiz-score-card">
        <div>
          <div class="pill">Books</div>
          <div class="score-big">{{ books|length }}</div>
          <div class="text-muted">Worlds to explore</div>
        </div>
        <div>
          <div class="pill">Tests</div>
          <div class="score-big">{{ total_tests }}</div>
          <div class="text-muted">Challenges waiting</div>
        </div>
      </div>
      <div class="divider"></div>
      <p class="mb-0">Choose a book to start playing or search for a specific test.</p>
    </div>
  </section>

  <section class="panel panel-strong">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h2 class="mb-1">Find your next challenge</h2>
        <p class="text-muted mb-0">Search across all books and tests, then jump into the play screen.</p>
      </div>
      {% if current_user.is_authenticated and current_user.is_admin %}
        <a class="pill-action" href="{{ url_for('tests.add_test') }}">+ Add a new test</a>
      {% endif %}
    </div>

    <form method="GET" action="{{ url_for('main.search') }}" class="search-panel mt-3" novalidate>
      <div class="input-shell">
        <label for="search_query">Search</label>
        <input
          type="text"
          name="query"
          id="search_query"
          placeholder="Search for books or tests"
          required
          data-autocomplete-url="{{ url_for('main.autocomplete_search') }}"
          data-option-target="#search_option"
          data-datalist-target="#search-suggestions"
          list="search-suggestions">
        <datalist id="search-suggestions"></datalist>
      </div>
      <div class="input-shell">
        <label for="search_option">Look in</label>
        <select name="search_option" id="search_option">
          <option value="books">Books</option>
          <option value="tests">Tests</option>
        </select>
      </div>
      <div class="input-shell">
        <button type="submit" class="btn-game btn-game-primary w-100">Search &amp; play</button>
      </div>
    </form>
  </section>

  <section class="panel panel-strong" id="book-grid">
    <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
      <div>
        <h2 class="mb-1">Available books</h2>
        <p class="text-muted mb-0">Pick a world to see its tests and start playing.</p>
      </div>
    </div>
    <div class="card-grid">
      {% for book in books %}
        <article class="book-card">
          <div class="pill">Tests: {{ book.tests|length }}</div>
          <h3>{{ book.title }}</h3>
          <p class="text-muted">A curated set of challenges designed to make practice feel like play.</p>
          <div class="divider"></div>
          <div class="hero-actions">
            <a href="{{ url_for('main.book_tests', book_id=book.id) }}" class="btn-game btn-game-primary">Play tests</a>
            {% if current_user.is_authenticated and current_user.is_admin %}
              <form action="{{ url_for('main.delete_book', book_id=book.id) }}" method="post" onsubmit="return confirm('Delete this book and its tests?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn-ghost">Delete</button>
              </form>
            {% endif %}
          </div>
        </article>
      {% else %}
        <p class="text-muted mb-0">No books available yet. Add a new one to begin.</p>
      {% endfor %}
    </div>
  </section>
{% endblock %}
